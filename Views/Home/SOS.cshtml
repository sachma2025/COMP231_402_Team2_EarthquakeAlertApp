@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Send Distress Signal</title>
    <link rel="stylesheet" href="~/css/SOS.css" />
</head>
<body>
    <h2>Send Distress Signal</h2>

    <form id="sosForm" class="sos-form">
        <label for="people">No. of People Affected:</label>
        <input type="number" id="people" name="people" min="1" value="1" required>

        <label for="problem">Problem/Situation:</label>
        <input type="text" id="problem" name="problem" placeholder="e.g., Trapped, Injured, Fire" required>

        <label for="message">Detailed Message (Optional):</label>
        <textarea id="message" name="message" placeholder="Injury severity, specific location details, supplies needed, etc."></textarea>
    </form>
    <br>
    <button class="sos-btn" onclick="sendSOS()">Send SOS</button>
    <p class="status" id="status"></p>

    <script>
        async function sendSOS() {
            const statusEl = document.getElementById("status");
            statusEl.textContent = "Sending distress signal...";

            if (!navigator.geolocation) {
                statusEl.textContent = "Geolocation is not supported by your browser.";
                return;
            }

            navigator.geolocation.getCurrentPosition(success, error);

            async function success(position) {
                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;
                const people = document.getElementById("people").value;
                const problem = document.getElementById("problem").value;
                const message = document.getElementById("message").value;

                const payload = { latitude, longitude, people, problem, message };

                try {
                    const response = await fetch('/Home/SendSOS', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        statusEl.textContent = "Distress signal sent successfully!";
                        document.querySelector(".sos-btn").disabled = true;
                    } else {
                        statusEl.textContent = "Failed to send SOS.";
                    }
                } catch (err) {
                    console.error(err);
                    statusEl.textContent = "Network error while sending SOS.";
                }
            }

            function error() {
                statusEl.textContent = "Unable to retrieve your location.";
            }
        }
    </script>
</body>
</html>
